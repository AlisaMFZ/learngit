{"version":3,"sources":["async.js"],"names":[],"mappings":"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","file":"async-compiled.js","sourcesContent":["'use strict';\n\nmodule.exports = {\n  setup: setupAsync,\n  compile: compileAsync\n};\n\n\nvar util = require('./compile/util');\n\nvar ASYNC = {\n  '*': checkGenerators,\n  'co*': checkGenerators,\n  'es7': checkAsyncFunction\n};\n\nvar TRANSPILE = {\n  'nodent': getNodent,\n  'regenerator': getRegenerator\n};\n\nvar MODES = [\n  { async: 'co*' },\n  { async: 'es7', transpile: 'nodent' },\n  { async: 'co*', transpile: 'regenerator' }\n];\n\n\nvar regenerator, nodent;\n\n\nfunction setupAsync(opts, required) {\n  if (required !== false) required = true;\n  var async = opts.async\n    , transpile = opts.transpile\n    , check;\n\n  switch (typeof transpile) {\n    case 'string':\n      var get = TRANSPILE[transpile];\n      if (!get) throw new Error('bad transpiler: ' + transpile);\n      return (opts._transpileFunc = get(opts, required));\n    case 'undefined':\n    case 'boolean':\n      if (typeof async == 'string') {\n        check = ASYNC[async];\n        if (!check) throw new Error('bad async mode: ' + async);\n        return (opts.transpile = check(opts, required));\n      }\n\n      for (var i=0; i<MODES.length; i++) {\n        var _opts = MODES[i];\n        if (setupAsync(_opts, false)) {\n          util.copy(_opts, opts);\n          return opts.transpile;\n        }\n      }\n      /* istanbul ignore next */\n      throw new Error('generators, nodent and regenerator are not available');\n    case 'function':\n      return (opts._transpileFunc = opts.transpile);\n    default:\n      throw new Error('bad transpiler: ' + transpile);\n  }\n}\n\n\nfunction checkGenerators(opts, required) {\n  /* jshint evil: true */\n  try {\n    (new Function('(function*(){})()'))();\n    return true;\n  } catch(e) {\n    /* istanbul ignore next */\n    if (required) throw new Error('generators not supported');\n  }\n}\n\n\nfunction checkAsyncFunction(opts, required) {\n  /* jshint evil: true */\n  try {\n    (new Function('(async function(){})()'))();\n    /* istanbul ignore next */\n    return true;\n  } catch(e) {\n    if (required) throw new Error('es7 async functions not supported');\n  }\n}\n\n\nfunction getRegenerator(opts, required) {\n  try {\n    if (!regenerator) {\n      var name = 'regenerator';\n      regenerator = require(name);\n      regenerator.runtime();\n    }\n    if (!opts.async || opts.async === true)\n      opts.async = 'es7';\n    return regeneratorTranspile;\n  } catch(e) {\n    /* istanbul ignore next */\n    if (required) throw new Error('regenerator not available');\n  }\n}\n\n\nfunction regeneratorTranspile(code) {\n  return regenerator.compile(code).code;\n}\n\n\nfunction getNodent(opts, required) {\n  /* jshint evil: true */\n  try {\n    if (!nodent) {\n      var name = 'nodent';\n      nodent = require(name)({ log: false, dontInstallRequireHook: true });\n    }\n    if (opts.async != 'es7') {\n      if (opts.async && opts.async !== true) console.warn('nodent transpiles only es7 async functions');\n      opts.async = 'es7';\n    }\n    return nodentTranspile;\n  } catch(e) {\n    /* istanbul ignore next */\n    if (required) throw new Error('nodent not available');\n  }\n}\n\n\nfunction nodentTranspile(code) {\n  return nodent.compile(code, '', { promises: true, sourcemap: false }).code;\n}\n\n\n/**\n * Creates validating function for passed schema with asynchronous loading of missing schemas.\n * `loadSchema` option should be a function that accepts schema uri and node-style callback.\n * @this  Ajv\n * @param {Object}   schema schema object\n * @param {Function} callback node-style callback, it is always called with 2 parameters: error (or null) and validating function.\n */\nfunction compileAsync(schema, callback) {\n  /* eslint no-shadow: 0 */\n  /* jshint validthis: true */\n  var schemaObj;\n  var self = this;\n  try {\n    schemaObj = this._addSchema(schema);\n  } catch(e) {\n    setTimeout(function() { callback(e); });\n    return;\n  }\n  if (schemaObj.validate) {\n    setTimeout(function() { callback(null, schemaObj.validate); });\n  } else {\n    if (typeof this._opts.loadSchema != 'function')\n      throw new Error('options.loadSchema should be a function');\n    _compileAsync(schema, callback, true);\n  }\n\n\n  function _compileAsync(schema, callback, firstCall) {\n    var validate;\n    try { validate = self.compile(schema); }\n    catch(e) {\n      if (e.missingSchema) loadMissingSchema(e);\n      else deferCallback(e);\n      return;\n    }\n    deferCallback(null, validate);\n\n    function loadMissingSchema(e) {\n      var ref = e.missingSchema;\n      if (self._refs[ref] || self._schemas[ref])\n        return callback(new Error('Schema ' + ref + ' is loaded but ' + e.missingRef + ' cannot be resolved'));\n      var _callbacks = self._loadingSchemas[ref];\n      if (_callbacks) {\n        if (typeof _callbacks == 'function')\n          self._loadingSchemas[ref] = [_callbacks, schemaLoaded];\n        else\n          _callbacks[_callbacks.length] = schemaLoaded;\n      } else {\n        self._loadingSchemas[ref] = schemaLoaded;\n        self._opts.loadSchema(ref, function (err, sch) {\n          var _callbacks = self._loadingSchemas[ref];\n          delete self._loadingSchemas[ref];\n          if (typeof _callbacks == 'function') {\n            _callbacks(err, sch);\n          } else {\n            for (var i=0; i<_callbacks.length; i++)\n              _callbacks[i](err, sch);\n          }\n        });\n      }\n\n      function schemaLoaded(err, sch) {\n        if (err) return callback(err);\n        if (!(self._refs[ref] || self._schemas[ref])) {\n          try {\n            self.addSchema(sch, ref);\n          } catch(e) {\n            callback(e);\n            return;\n          }\n        }\n        _compileAsync(schema, callback);\n      }\n    }\n\n    function deferCallback(err, validate) {\n      if (firstCall) setTimeout(function() { callback(err, validate); });\n      else return callback(err, validate);\n    }\n  }\n}\n"]}