{"version":3,"sources":["1-initialMergeRuleset.js"],"names":[],"mappings":";;AAAA,IAAI,QAAQ,QAAQ,YAAR,CAAZ;AACA,IAAI,YAAY,QAAQ,qBAAR,EAA+B,KAA/C;;AAEA,SAAS,cAAT,CAAwB,IAAxB,EAA8B,IAA9B,EAAoC,IAApC,EAA0C;AACtC,QAAI,YAAY,KAAK,QAAL,CAAc,SAA9B;AACA,QAAI,eAAe,KAAK,KAAL,CAAW,YAA9B;;AAEA,SAAK,SAAL,CAAe,KAAK,IAApB,EAA0B,UAAS,IAAT,EAAe;AACrC;AACA,YAAI,KAAK,IAAL,KAAc,SAAlB,EAA6B;AACzB,mBAAO,MAAM,gBAAN,CAAuB,IAAvB,CAA4B,SAA5B,EAAuC,IAAvC,CAAP;AACH;;AAED,YAAI,gBAAgB,KAAK,QAAL,CAAc,SAAlC;AACA,YAAI,mBAAmB,KAAK,KAAL,CAAW,YAAlC;;AAEA;AACA,YAAI,KAAK,eAAL,KAAyB,KAAK,eAAlC,EAAmD;AAC/C;AACA,gBAAI,MAAM,YAAN,CAAmB,aAAnB,EAAkC,SAAlC,CAAJ,EAAkD;AAC9C,iCAAiB,UAAjB,CAA4B,YAA5B;AACA,qBAAK,MAAL,CAAY,IAAZ;AACA,uBAAO,IAAP;AACH;;AAED;AACA,gBAAI,MAAM,mBAAN,CAA0B,YAA1B,EAAwC,gBAAxC,CAAJ,EAA+D;AAC3D,sBAAM,YAAN,CAAmB,aAAnB,EAAkC,SAAlC;AACA,qBAAK,MAAL,CAAY,IAAZ;AACA,uBAAO,IAAP;AACH;AACJ;;AAED;AACA,eAAO,MAAM,mBAAN,CAA0B,SAA1B,EAAqC,aAArC,CAAP;AACH,KA5BD;AA6BH;;AAED;AACA;AACA;AACA,OAAO,OAAP,GAAiB,SAAS,mBAAT,CAA6B,GAA7B,EAAkC;AAC/C,cAAU,GAAV,EAAe,UAAS,IAAT,EAAe,IAAf,EAAqB,IAArB,EAA2B;AACtC,YAAI,KAAK,IAAL,KAAc,SAAlB,EAA6B;AACzB,2BAAe,IAAf,EAAqB,IAArB,EAA2B,IAA3B;AACH;AACJ,KAJD;AAKH,CAND","file":"1-initialMergeRuleset-compiled.js","sourcesContent":["var utils = require('./utils.js');\nvar walkRules = require('../../utils/walk.js').rules;\n\nfunction processRuleset(node, item, list) {\n    var selectors = node.selector.selectors;\n    var declarations = node.block.declarations;\n\n    list.prevUntil(item.prev, function(prev) {\n        // skip non-ruleset node if safe\n        if (prev.type !== 'Ruleset') {\n            return utils.unsafeToSkipNode.call(selectors, prev);\n        }\n\n        var prevSelectors = prev.selector.selectors;\n        var prevDeclarations = prev.block.declarations;\n\n        // try to join rulesets with equal pseudo signature\n        if (node.pseudoSignature === prev.pseudoSignature) {\n            // try to join by selectors\n            if (utils.isEqualLists(prevSelectors, selectors)) {\n                prevDeclarations.appendList(declarations);\n                list.remove(item);\n                return true;\n            }\n\n            // try to join by declarations\n            if (utils.isEqualDeclarations(declarations, prevDeclarations)) {\n                utils.addSelectors(prevSelectors, selectors);\n                list.remove(item);\n                return true;\n            }\n        }\n\n        // go to prev ruleset if has no selector similarities\n        return utils.hasSimilarSelectors(selectors, prevSelectors);\n    });\n};\n\n// NOTE: direction should be left to right, since rulesets merge to left\n// ruleset. When direction right to left unmerged rulesets may prevent lookup\n// TODO: remove initial merge\nmodule.exports = function initialMergeRuleset(ast) {\n    walkRules(ast, function(node, item, list) {\n        if (node.type === 'Ruleset') {\n            processRuleset(node, item, list);\n        }\n    });\n};\n"]}