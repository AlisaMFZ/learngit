{"version":3,"sources":["4-restructShorthand.js"],"names":[],"mappings":"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","file":"4-restructShorthand-compiled.js","sourcesContent":["var List = require('../../utils/list.js');\nvar translate = require('../../utils/translate.js');\nvar walkRulesRight = require('../../utils/walk.js').rulesRight;\n\nvar REPLACE = 1;\nvar REMOVE = 2;\nvar TOP = 0;\nvar RIGHT = 1;\nvar BOTTOM = 2;\nvar LEFT = 3;\nvar SIDES = ['top', 'right', 'bottom', 'left'];\nvar SIDE = {\n    'margin-top': 'top',\n    'margin-right': 'right',\n    'margin-bottom': 'bottom',\n    'margin-left': 'left',\n\n    'padding-top': 'top',\n    'padding-right': 'right',\n    'padding-bottom': 'bottom',\n    'padding-left': 'left',\n\n    'border-top-color': 'top',\n    'border-right-color': 'right',\n    'border-bottom-color': 'bottom',\n    'border-left-color': 'left',\n    'border-top-width': 'top',\n    'border-right-width': 'right',\n    'border-bottom-width': 'bottom',\n    'border-left-width': 'left',\n    'border-top-style': 'top',\n    'border-right-style': 'right',\n    'border-bottom-style': 'bottom',\n    'border-left-style': 'left'\n};\nvar MAIN_PROPERTY = {\n    'margin': 'margin',\n    'margin-top': 'margin',\n    'margin-right': 'margin',\n    'margin-bottom': 'margin',\n    'margin-left': 'margin',\n\n    'padding': 'padding',\n    'padding-top': 'padding',\n    'padding-right': 'padding',\n    'padding-bottom': 'padding',\n    'padding-left': 'padding',\n\n    'border-color': 'border-color',\n    'border-top-color': 'border-color',\n    'border-right-color': 'border-color',\n    'border-bottom-color': 'border-color',\n    'border-left-color': 'border-color',\n    'border-width': 'border-width',\n    'border-top-width': 'border-width',\n    'border-right-width': 'border-width',\n    'border-bottom-width': 'border-width',\n    'border-left-width': 'border-width',\n    'border-style': 'border-style',\n    'border-top-style': 'border-style',\n    'border-right-style': 'border-style',\n    'border-bottom-style': 'border-style',\n    'border-left-style': 'border-style'\n};\n\nfunction TRBL(name) {\n    this.name = name;\n    this.info = null;\n    this.iehack = undefined;\n    this.sides = {\n        'top': null,\n        'right': null,\n        'bottom': null,\n        'left': null\n    };\n}\n\nTRBL.prototype.getValueSequence = function(value, count) {\n    var values = [];\n    var iehack = '';\n    var hasBadValues = value.sequence.some(function(child) {\n        var special = false;\n\n        switch (child.type) {\n            case 'Identifier':\n                switch (child.name) {\n                    case '\\\\0':\n                    case '\\\\9':\n                        iehack = child.name;\n                        return;\n\n                    case 'inherit':\n                    case 'initial':\n                    case 'unset':\n                    case 'revert':\n                        special = child.name;\n                        break;\n                }\n                break;\n\n            case 'Dimension':\n                switch (child.unit) {\n                    // is not supported until IE11\n                    case 'rem':\n\n                    // v* units is too buggy across browsers and better\n                    // don't merge values with those units\n                    case 'vw':\n                    case 'vh':\n                    case 'vmin':\n                    case 'vmax':\n                    case 'vm': // IE9 supporting \"vm\" instead of \"vmin\".\n                        special = child.unit;\n                        break;\n                }\n                break;\n\n            case 'Hash': // color\n            case 'Number':\n            case 'Percentage':\n                break;\n\n            case 'Function':\n                special = child.name;\n                break;\n\n            case 'Space':\n                return false; // ignore space\n\n            default:\n                return true;  // bad value\n        }\n\n        values.push({\n            node: child,\n            special: special,\n            important: value.important\n        });\n    });\n\n    if (hasBadValues || values.length > count) {\n        return false;\n    }\n\n    if (typeof this.iehack === 'string' && this.iehack !== iehack) {\n        return false;\n    }\n\n    this.iehack = iehack; // move outside\n\n    return values;\n};\n\nTRBL.prototype.canOverride = function(side, value) {\n    var currentValue = this.sides[side];\n\n    return !currentValue || (value.important && !currentValue.important);\n};\n\nTRBL.prototype.add = function(name, value, info) {\n    function attemptToAdd() {\n        var sides = this.sides;\n        var side = SIDE[name];\n\n        if (side) {\n            if (side in sides === false) {\n                return false;\n            }\n\n            var values = this.getValueSequence(value, 1);\n\n            if (!values || !values.length) {\n                return false;\n            }\n\n            // can mix only if specials are equal\n            for (var key in sides) {\n                if (sides[key] !== null && sides[key].special !== values[0].special) {\n                    return false;\n                }\n            }\n\n            if (!this.canOverride(side, values[0])) {\n                return true;\n            }\n\n            sides[side] = values[0];\n            return true;\n        } else if (name === this.name) {\n            var values = this.getValueSequence(value, 4);\n\n            if (!values || !values.length) {\n                return false;\n            }\n\n            switch (values.length) {\n                case 1:\n                    values[RIGHT] = values[TOP];\n                    values[BOTTOM] = values[TOP];\n                    values[LEFT] = values[TOP];\n                    break;\n\n                case 2:\n                    values[BOTTOM] = values[TOP];\n                    values[LEFT] = values[RIGHT];\n                    break;\n\n                case 3:\n                    values[LEFT] = values[RIGHT];\n                    break;\n            }\n\n            // can mix only if specials are equal\n            for (var i = 0; i < 4; i++) {\n                for (var key in sides) {\n                    if (sides[key] !== null && sides[key].special !== values[i].special) {\n                        return false;\n                    }\n                }\n            }\n\n            for (var i = 0; i < 4; i++) {\n                if (this.canOverride(SIDES[i], values[i])) {\n                    sides[SIDES[i]] = values[i];\n                }\n            }\n\n            return true;\n        }\n    }\n\n    if (!attemptToAdd.call(this)) {\n        return false;\n    }\n\n    if (this.info) {\n        this.info = {\n            primary: this.info,\n            merged: info\n        };\n    } else {\n        this.info = info;\n    }\n\n    return true;\n};\n\nTRBL.prototype.isOkToMinimize = function() {\n    var top = this.sides.top;\n    var right = this.sides.right;\n    var bottom = this.sides.bottom;\n    var left = this.sides.left;\n\n    if (top && right && bottom && left) {\n        var important =\n            top.important +\n            right.important +\n            bottom.important +\n            left.important;\n\n        return important === 0 || important === 4;\n    }\n\n    return false;\n};\n\nTRBL.prototype.getValue = function() {\n    var result = [];\n    var sides = this.sides;\n    var values = [\n        sides.top,\n        sides.right,\n        sides.bottom,\n        sides.left\n    ];\n    var stringValues = [\n        translate(sides.top.node),\n        translate(sides.right.node),\n        translate(sides.bottom.node),\n        translate(sides.left.node)\n    ];\n\n    if (stringValues[LEFT] === stringValues[RIGHT]) {\n        values.pop();\n        if (stringValues[BOTTOM] === stringValues[TOP]) {\n            values.pop();\n            if (stringValues[RIGHT] === stringValues[TOP]) {\n                values.pop();\n            }\n        }\n    }\n\n    for (var i = 0; i < values.length; i++) {\n        if (i) {\n            result.push({ type: 'Space' });\n        }\n\n        result.push(values[i].node);\n    }\n\n    if (this.iehack) {\n        result.push({ type: 'Space' }, {\n            type: 'Identifier',\n            info: {},\n            name: this.iehack\n        });\n    }\n\n    return {\n        type: 'Value',\n        info: {},\n        important: sides.top.important,\n        sequence: new List(result)\n    };\n};\n\nTRBL.prototype.getProperty = function() {\n    return {\n        type: 'Property',\n        info: {},\n        name: this.name\n    };\n};\n\nfunction processRuleset(ruleset, shorts, shortDeclarations, lastShortSelector) {\n    var declarations = ruleset.block.declarations;\n    var selector = ruleset.selector.selectors.first().id;\n\n    ruleset.block.declarations.eachRight(function(declaration, item) {\n        var property = declaration.property.name;\n\n        if (!MAIN_PROPERTY.hasOwnProperty(property)) {\n            return;\n        }\n\n        var key = MAIN_PROPERTY[property];\n        var shorthand;\n        var operation;\n\n        if (!lastShortSelector || selector === lastShortSelector) {\n            if (key in shorts) {\n                operation = REMOVE;\n                shorthand = shorts[key];\n            }\n        }\n\n        if (!shorthand || !shorthand.add(property, declaration.value, declaration.info)) {\n            operation = REPLACE;\n            shorthand = new TRBL(key);\n\n            // if can't parse value ignore it and break shorthand sequence\n            if (!shorthand.add(property, declaration.value, declaration.info)) {\n                lastShortSelector = null;\n                return;\n            }\n        }\n\n        shorts[key] = shorthand;\n        shortDeclarations.push({\n            operation: operation,\n            block: declarations,\n            item: item,\n            shorthand: shorthand\n        });\n\n        lastShortSelector = selector;\n    });\n\n    return lastShortSelector;\n};\n\nfunction processShorthands(shortDeclarations, markDeclaration) {\n    shortDeclarations.forEach(function(item) {\n        var shorthand = item.shorthand;\n\n        if (!shorthand.isOkToMinimize()) {\n            return;\n        }\n\n        if (item.operation === REPLACE) {\n            item.item.data = markDeclaration({\n                type: 'Declaration',\n                info: shorthand.info,\n                property: shorthand.getProperty(),\n                value: shorthand.getValue(),\n                id: 0,\n                length: 0,\n                fingerprint: null\n            });\n        } else {\n            item.block.remove(item.item);\n        }\n    });\n};\n\nmodule.exports = function restructBlock(ast, indexer) {\n    var stylesheetMap = {};\n    var shortDeclarations = [];\n\n    walkRulesRight(ast, function(node) {\n        if (node.type !== 'Ruleset') {\n            return;\n        }\n\n        var stylesheet = this.stylesheet;\n        var rulesetId = (node.pseudoSignature || '') + '|' + node.selector.selectors.first().id;\n        var rulesetMap;\n        var shorts;\n\n        if (!stylesheetMap.hasOwnProperty(stylesheet.id)) {\n            rulesetMap = {\n                lastShortSelector: null\n            };\n            stylesheetMap[stylesheet.id] = rulesetMap;\n        } else {\n            rulesetMap = stylesheetMap[stylesheet.id];\n        }\n\n        if (rulesetMap.hasOwnProperty(rulesetId)) {\n            shorts = rulesetMap[rulesetId];\n        } else {\n            shorts = {};\n            rulesetMap[rulesetId] = shorts;\n        }\n\n        rulesetMap.lastShortSelector = processRuleset.call(this, node, shorts, shortDeclarations, rulesetMap.lastShortSelector);\n    });\n\n    processShorthands(shortDeclarations, indexer.declaration);\n};\n"]}