{"version":3,"sources":["7-mergeRuleset.js"],"names":[],"mappings":";;AAAA,IAAI,QAAQ,QAAQ,YAAR,CAAZ;AACA,IAAI,YAAY,QAAQ,qBAAR,EAA+B,KAA/C;;AAEA;;;;;;;;;;;;AAYA,SAAS,cAAT,CAAwB,IAAxB,EAA8B,IAA9B,EAAoC,IAApC,EAA0C;AACtC,QAAI,YAAY,KAAK,QAAL,CAAc,SAA9B;AACA,QAAI,eAAe,KAAK,KAAL,CAAW,YAA9B;AACA,QAAI,oBAAoB,UAAU,KAAV,GAAkB,aAA1C;AACA,QAAI,wBAAwB,EAA5B;;AAEA,SAAK,SAAL,CAAe,KAAK,IAApB,EAA0B,UAAS,IAAT,EAAe,QAAf,EAAyB;AAC/C;AACA,YAAI,KAAK,IAAL,KAAc,SAAlB,EAA6B;AACzB,mBAAO,MAAM,gBAAN,CAAuB,IAAvB,CAA4B,SAA5B,EAAuC,IAAvC,CAAP;AACH;;AAED,YAAI,KAAK,eAAL,KAAyB,KAAK,eAAlC,EAAmD;AAC/C,mBAAO,IAAP;AACH;;AAED,YAAI,oBAAoB,KAAK,QAAL,CAAc,SAAd,CAAwB,IAAhD;AACA,YAAI,mBAAmB,KAAK,KAAL,CAAW,YAAlC;AACA,YAAI,oBAAoB,kBAAkB,IAAlB,CAAuB,aAA/C;;AAEA;AACA,YAAI,qBAAqB,qBAAzB,EAAgD;AAC5C,mBAAO,IAAP;AACH;;AAED;AACA,YAAI,UAAU,IAAV,KAAmB,UAAU,IAAjC,EAAuC;AACnC,gBAAI,UAAU,KAAV,GAAkB,EAAlB,KAAyB,kBAAkB,IAAlB,CAAuB,EAApD,EAAwD;AACpD,6BAAa,UAAb,CAAwB,gBAAxB;AACA,qBAAK,MAAL,CAAY,QAAZ;AACA;AACH;AACJ;;AAED;AACA,YAAI,MAAM,mBAAN,CAA0B,YAA1B,EAAwC,gBAAxC,CAAJ,EAA+D;AAC3D,gBAAI,UAAU,kBAAkB,IAAlB,CAAuB,EAArC;;AAEA,sBAAU,IAAV,CAAe,UAAS,IAAT,EAAe,IAAf,EAAqB;AAChC,oBAAI,SAAS,KAAK,EAAlB;;AAEA,oBAAI,UAAU,MAAd,EAAsB;AAClB,8BAAU,MAAV,CAAiB,iBAAjB,EAAoC,IAApC;AACA,2BAAO,IAAP;AACH;;AAED,oBAAI,CAAC,KAAK,IAAV,EAAgB;AACZ,8BAAU,MAAV,CAAiB,iBAAjB;AACA,2BAAO,IAAP;AACH;AACJ,aAZD;;AAcA,iBAAK,MAAL,CAAY,QAAZ;AACA;AACH;;AAED;AACA,YAAI,sBAAsB,iBAA1B,EAA6C;AACzC,mBAAO,IAAP;AACH;;AAED,8BAAsB,iBAAtB,IAA2C,IAA3C;AACH,KAxDD;AAyDH;;AAED,OAAO,OAAP,GAAiB,SAAS,YAAT,CAAsB,GAAtB,EAA2B;AACxC,cAAU,GAAV,EAAe,UAAS,IAAT,EAAe,IAAf,EAAqB,IAArB,EAA2B;AACtC,YAAI,KAAK,IAAL,KAAc,SAAlB,EAA6B;AACzB,2BAAe,IAAf,EAAqB,IAArB,EAA2B,IAA3B;AACH;AACJ,KAJD;AAKH,CAND","file":"7-mergeRuleset-compiled.js","sourcesContent":["var utils = require('./utils.js');\nvar walkRules = require('../../utils/walk.js').rules;\n\n/*\n    At this step all rules has single simple selector. We try to join by equal\n    declaration blocks to first rule, e.g.\n\n    .a { color: red }\n    b { ... }\n    .b { color: red }\n    ->\n    .a, .b { color: red }\n    b { ... }\n*/\n\nfunction processRuleset(node, item, list) {\n    var selectors = node.selector.selectors;\n    var declarations = node.block.declarations;\n    var nodeCompareMarker = selectors.first().compareMarker;\n    var skippedCompareMarkers = {};\n\n    list.nextUntil(item.next, function(next, nextItem) {\n        // skip non-ruleset node if safe\n        if (next.type !== 'Ruleset') {\n            return utils.unsafeToSkipNode.call(selectors, next);\n        }\n\n        if (node.pseudoSignature !== next.pseudoSignature) {\n            return true;\n        }\n\n        var nextFirstSelector = next.selector.selectors.head;\n        var nextDeclarations = next.block.declarations;\n        var nextCompareMarker = nextFirstSelector.data.compareMarker;\n\n        // if next ruleset has same marked as one of skipped then stop joining\n        if (nextCompareMarker in skippedCompareMarkers) {\n            return true;\n        }\n\n        // try to join by selectors\n        if (selectors.head === selectors.tail) {\n            if (selectors.first().id === nextFirstSelector.data.id) {\n                declarations.appendList(nextDeclarations);\n                list.remove(nextItem);\n                return;\n            }\n        }\n\n        // try to join by properties\n        if (utils.isEqualDeclarations(declarations, nextDeclarations)) {\n            var nextStr = nextFirstSelector.data.id;\n\n            selectors.some(function(data, item) {\n                var curStr = data.id;\n\n                if (nextStr < curStr) {\n                    selectors.insert(nextFirstSelector, item);\n                    return true;\n                }\n\n                if (!item.next) {\n                    selectors.insert(nextFirstSelector);\n                    return true;\n                }\n            });\n\n            list.remove(nextItem);\n            return;\n        }\n\n        // go to next ruleset if current one can be skipped (has no equal specificity nor element selector)\n        if (nextCompareMarker === nodeCompareMarker) {\n            return true;\n        }\n\n        skippedCompareMarkers[nextCompareMarker] = true;\n    });\n};\n\nmodule.exports = function mergeRuleset(ast) {\n    walkRules(ast, function(node, item, list) {\n        if (node.type === 'Ruleset') {\n            processRuleset(node, item, list);\n        }\n    });\n};\n"]}