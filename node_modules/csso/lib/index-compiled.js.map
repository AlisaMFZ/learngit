{"version":3,"sources":["index.js"],"names":[],"mappings":";;AAAA,IAAI,QAAQ,QAAQ,UAAR,CAAZ;AACA,IAAI,WAAW,QAAQ,cAAR,CAAf;AACA,IAAI,YAAY,QAAQ,mBAAR,CAAhB;AACA,IAAI,yBAAyB,QAAQ,gCAAR,CAA7B;AACA,IAAI,UAAU,QAAQ,cAAR,CAAd;AACA,IAAI,QAAQ,QAAQ,eAAR,CAAZ;AACA,IAAI,OAAO,QAAQ,cAAR,CAAX;;AAEA,SAAS,WAAT,CAAqB,IAArB,EAA2B,OAA3B,EAAoC,SAApC,EAA+C,IAA/C,EAAqD;AACjD,QAAI,QAAQ,KAAZ,EAAmB;AACf,gBAAQ,KAAR,CAAc,QAAQ,IAAR,GAAe,kBAA7B,EAAiD,KAAK,GAAL,KAAa,SAA9D;AACH;;AAED,WAAO,IAAP;AACH;;AAED,SAAS,mBAAT,CAA6B,KAA7B,EAAoC;AAChC,QAAI,SAAJ;;AAEA,WAAO,SAAS,MAAT,CAAgB,KAAhB,EAAuB,GAAvB,EAA4B;AAC/B,YAAI,OAAO,KAAX;;AAEA,YAAI,GAAJ,EAAS;AACL,mBAAO,MAAM,CAAC,CAAC,KAAK,GAAL,KAAa,SAAd,IAA2B,IAA5B,EAAkC,OAAlC,CAA0C,CAA1C,CAAN,GAAqD,KAArD,GAA6D,IAApE;AACH;;AAED,YAAI,QAAQ,CAAR,IAAa,GAAjB,EAAsB;AAClB,gBAAI,MAAM,UAAU,GAAV,EAAe,IAAf,CAAV;;AAEA;AACA,gBAAI,UAAU,CAAV,IAAe,IAAI,MAAJ,GAAa,GAAhC,EAAqC;AACjC,sBAAM,IAAI,MAAJ,CAAW,CAAX,EAAc,GAAd,IAAqB,KAA3B;AACH;;AAED,oBAAQ,SAAS,GAAT,GAAe,IAAvB;AACH;;AAED,gBAAQ,KAAR,CAAc,IAAd;AACA,oBAAY,KAAK,GAAL,EAAZ;AACH,KApBD;AAqBH;;AAED,SAAS,IAAT,CAAc,GAAd,EAAmB;AACf,QAAI,SAAS,EAAb;;AAEA,SAAK,IAAI,GAAT,IAAgB,GAAhB,EAAqB;AACjB,eAAO,GAAP,IAAc,IAAI,GAAJ,CAAd;AACH;;AAED,WAAO,MAAP;AACH;;AAED,SAAS,oBAAT,CAA8B,OAA9B,EAAuC;AACnC,cAAU,KAAK,OAAL,CAAV;;AAEA,QAAI,OAAO,QAAQ,MAAf,KAA0B,UAA1B,IAAwC,QAAQ,KAApD,EAA2D;AACvD,gBAAQ,MAAR,GAAiB,oBAAoB,QAAQ,KAA5B,CAAjB;AACH;;AAED,WAAO,OAAP;AACH;;AAED,SAAS,UAAT,CAAoB,GAApB,EAAyB,OAAzB,EAAkC,QAAlC,EAA4C;AACxC,QAAI,CAAC,MAAM,OAAN,CAAc,QAAd,CAAL,EAA8B;AAC1B,mBAAW,CAAC,QAAD,CAAX;AACH;;AAED,aAAS,OAAT,CAAiB,UAAS,EAAT,EAAa;AAC1B,WAAG,GAAH,EAAQ,OAAR;AACH,KAFD;AAGH;;AAED,SAAS,MAAT,CAAgB,OAAhB,EAAyB,MAAzB,EAAiC,OAAjC,EAA0C;AACtC,cAAU,WAAW,EAArB;;AAEA,QAAI,WAAW,QAAQ,QAAR,IAAoB,WAAnC;AACA,QAAI,MAAJ;;AAEA;AACA,QAAI,MAAM,YAAY,SAAZ,EAAuB,OAAvB,EAAgC,KAAK,GAAL,EAAhC,EACN,MAAM,MAAN,EAAc;AACV,iBAAS,OADC;AAEV,kBAAU,QAFA;AAGV,mBAAW,QAAQ,QAAQ,SAAhB;AAHD,KAAd,CADM,CAAV;;AAQA;AACA,QAAI,QAAQ,cAAZ,EAA4B;AACxB,oBAAY,gBAAZ,EAA8B,OAA9B,EAAuC,KAAK,GAAL,EAAvC,EACI,WAAW,GAAX,EAAgB,OAAhB,EAAyB,QAAQ,cAAjC,CADJ;AAGH;;AAED;AACA,QAAI,iBAAiB,YAAY,UAAZ,EAAwB,OAAxB,EAAiC,KAAK,GAAL,EAAjC,EACjB,SAAS,GAAT,EAAc,qBAAqB,OAArB,CAAd,CADiB,CAArB;;AAIA;AACA,QAAI,QAAQ,aAAZ,EAA2B;AACvB,oBAAY,eAAZ,EAA6B,OAA7B,EAAsC,KAAK,GAAL,EAAtC,EACI,WAAW,cAAX,EAA2B,OAA3B,EAAoC,QAAQ,aAA5C,CADJ;AAGH;;AAED;AACA,QAAI,QAAQ,SAAZ,EAAuB;AACnB,iBAAS,YAAY,wBAAZ,EAAsC,OAAtC,EAA+C,KAAK,GAAL,EAA/C,EAA4D,YAAW;AAC5E,gBAAI,MAAM,uBAAuB,eAAe,GAAtC,CAAV;AACA,gBAAI,GAAJ,CAAQ,KAAR,GAAgB,QAAhB,CAF4E,CAElD;AAC1B,gBAAI,GAAJ,CAAQ,gBAAR,CAAyB,QAAzB,EAAmC,MAAnC;AACA,mBAAO,GAAP;AACH,SALmE,EAA3D,CAAT;AAMH,KAPD,MAOO;AACH,iBAAS,YAAY,WAAZ,EAAyB,OAAzB,EAAkC,KAAK,GAAL,EAAlC,EAA8C;AACnD,iBAAK,UAAU,eAAe,GAAzB,CAD8C;AAEnD,iBAAK;AAF8C,SAA9C,CAAT;AAIH;;AAED,WAAO,MAAP;AACH;;AAED,SAAS,gBAAT,CAA0B,MAA1B,EAAkC,OAAlC,EAA2C;AACvC,WAAO,OAAO,YAAP,EAAqB,MAArB,EAA6B,OAA7B,CAAP;AACH;;AAED,SAAS,WAAT,CAAqB,MAArB,EAA6B,OAA7B,EAAsC;AAClC,WAAO,OAAO,OAAP,EAAgB,MAAhB,EAAwB,OAAxB,CAAP;AACH;;AAED,OAAO,OAAP,GAAiB;AACb,aAAS,QAAQ,iBAAR,EAA2B,OADvB;;AAGb;AACA,UAAM,IAJO;;AAMb;AACA,YAAQ,gBAPK;AAQb,iBAAa,WARA;;AAUb;AACA,WAAO,KAXM;AAYb,cAAU,QAZG;AAab,eAAW,SAbE;AAcb,4BAAwB,sBAdX;;AAgBb;AACA,UAAM,QAAQ,GAjBD;AAkBb,eAAW,QAAQ,KAlBN;AAmBb,oBAAgB,QAAQ,UAnBX;;AAqBb;AACA,WAAO;AAtBM,CAAjB","file":"index-compiled.js","sourcesContent":["var parse = require('./parser');\nvar compress = require('./compressor');\nvar translate = require('./utils/translate');\nvar translateWithSourceMap = require('./utils/translateWithSourceMap');\nvar walkers = require('./utils/walk');\nvar clone = require('./utils/clone');\nvar List = require('./utils/list');\n\nfunction debugOutput(name, options, startTime, data) {\n    if (options.debug) {\n        console.error('## ' + name + ' done in %d ms\\n', Date.now() - startTime);\n    }\n\n    return data;\n}\n\nfunction createDefaultLogger(level) {\n    var lastDebug;\n\n    return function logger(title, ast) {\n        var line = title;\n\n        if (ast) {\n            line = '[' + ((Date.now() - lastDebug) / 1000).toFixed(3) + 's] ' + line;\n        }\n\n        if (level > 1 && ast) {\n            var css = translate(ast, true);\n\n            // when level 2, limit css to 256 symbols\n            if (level === 2 && css.length > 256) {\n                css = css.substr(0, 256) + '...';\n            }\n\n            line += '\\n  ' + css + '\\n';\n        }\n\n        console.error(line);\n        lastDebug = Date.now();\n    };\n}\n\nfunction copy(obj) {\n    var result = {};\n\n    for (var key in obj) {\n        result[key] = obj[key];\n    }\n\n    return result;\n}\n\nfunction buildCompressOptions(options) {\n    options = copy(options);\n\n    if (typeof options.logger !== 'function' && options.debug) {\n        options.logger = createDefaultLogger(options.debug);\n    }\n\n    return options;\n}\n\nfunction runHandler(ast, options, handlers) {\n    if (!Array.isArray(handlers)) {\n        handlers = [handlers];\n    }\n\n    handlers.forEach(function(fn) {\n        fn(ast, options);\n    });\n}\n\nfunction minify(context, source, options) {\n    options = options || {};\n\n    var filename = options.filename || '<unknown>';\n    var result;\n\n    // parse\n    var ast = debugOutput('parsing', options, Date.now(),\n        parse(source, {\n            context: context,\n            filename: filename,\n            positions: Boolean(options.sourceMap)\n        })\n    );\n\n    // before compress handlers\n    if (options.beforeCompress) {\n        debugOutput('beforeCompress', options, Date.now(),\n            runHandler(ast, options, options.beforeCompress)\n        );\n    }\n\n    // compress\n    var compressResult = debugOutput('compress', options, Date.now(),\n        compress(ast, buildCompressOptions(options))\n    );\n\n    // after compress handlers\n    if (options.afterCompress) {\n        debugOutput('afterCompress', options, Date.now(),\n            runHandler(compressResult, options, options.afterCompress)\n        );\n    }\n\n    // translate\n    if (options.sourceMap) {\n        result = debugOutput('translateWithSourceMap', options, Date.now(), (function() {\n            var tmp = translateWithSourceMap(compressResult.ast);\n            tmp.map._file = filename; // since other tools can relay on file in source map transform chain\n            tmp.map.setSourceContent(filename, source);\n            return tmp;\n        })());\n    } else {\n        result = debugOutput('translate', options, Date.now(), {\n            css: translate(compressResult.ast),\n            map: null\n        });\n    }\n\n    return result;\n}\n\nfunction minifyStylesheet(source, options) {\n    return minify('stylesheet', source, options);\n};\n\nfunction minifyBlock(source, options) {\n    return minify('block', source, options);\n}\n\nmodule.exports = {\n    version: require('../package.json').version,\n\n    // classes\n    List: List,\n\n    // main methods\n    minify: minifyStylesheet,\n    minifyBlock: minifyBlock,\n\n    // step by step\n    parse: parse,\n    compress: compress,\n    translate: translate,\n    translateWithSourceMap: translateWithSourceMap,\n\n    // walkers\n    walk: walkers.all,\n    walkRules: walkers.rules,\n    walkRulesRight: walkers.rulesRight,\n\n    // utils\n    clone: clone\n};\n"]}