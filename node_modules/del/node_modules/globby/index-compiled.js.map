{"version":3,"sources":["index.js"],"names":[],"mappings":"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","file":"index-compiled.js","sourcesContent":["'use strict';\nvar union = require('array-union');\nvar assign = require('object-assign');\nvar async = require('async');\nvar glob = require('glob');\n\nfunction arrayify(arr) {\n\treturn Array.isArray(arr) ? arr : [arr];\n}\n\nfunction sortPatterns(patterns) {\n\tpatterns = arrayify(patterns);\n\n\tvar positives = [];\n\tvar negatives = [];\n\n\tpatterns.forEach(function (pattern, index) {\n\t\tvar isNegative = pattern[0] === '!';\n\t\t(isNegative ? negatives : positives).push({\n\t\t\tindex: index,\n\t\t\tpattern: isNegative ? pattern.slice(1) : pattern\n\t\t});\n\t});\n\n\treturn {\n\t\tpositives: positives,\n\t\tnegatives: negatives\n\t};\n}\n\nfunction setIgnore(opts, negatives, positiveIndex) {\n\topts = assign({}, opts);\n\n\tvar negativePatterns = negatives.filter(function (negative) {\n\t\treturn negative.index > positiveIndex;\n\t}).map(function (negative) {\n\t\treturn negative.pattern;\n\t});\n\n\topts.ignore = (opts.ignore || []).concat(negativePatterns);\n\treturn opts;\n}\n\nmodule.exports = function (patterns, opts, cb) {\n\tvar sortedPatterns = sortPatterns(patterns);\n\n\tif (typeof opts === 'function') {\n\t\tcb = opts;\n\t\topts = {};\n\t}\n\n\tif (sortedPatterns.positives.length === 0) {\n\t\tcb(null, []);\n\t\treturn;\n\t}\n\n\tasync.parallel(sortedPatterns.positives.map(function (positive) {\n\t\treturn function (cb2) {\n\t\t\tglob(positive.pattern, setIgnore(opts, sortedPatterns.negatives, positive.index), function (err, paths) {\n\t\t\t\tif (err) {\n\t\t\t\t\tcb2(err);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tcb2(null, paths);\n\t\t\t});\n\t\t};\n\t}), function (err, paths) {\n\t\tif (err) {\n\t\t\tcb(err);\n\t\t\treturn;\n\t\t}\n\n\t\tcb(null, union.apply(null, paths));\n\t});\n};\n\nmodule.exports.sync = function (patterns, opts) {\n\tvar sortedPatterns = sortPatterns(patterns);\n\n\tif (sortedPatterns.positives.length === 0) {\n\t\treturn [];\n\t}\n\n\treturn sortedPatterns.positives.reduce(function (ret, positive) {\n\t\treturn union(ret, glob.sync(positive.pattern, setIgnore(opts, sortedPatterns.negatives, positive.index)));\n\t}, []);\n};\n"]}