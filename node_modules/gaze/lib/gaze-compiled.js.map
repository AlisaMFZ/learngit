{"version":3,"sources":["gaze.js"],"names":[],"mappings":"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","file":"gaze-compiled.js","sourcesContent":["/*\n * gaze\n * https://github.com/shama/gaze\n *\n * Copyright (c) 2013 Kyle Robinson Young\n * Licensed under the MIT license.\n */\n\n'use strict';\n\n// libs\nvar util = require('util');\nvar EE = require('events').EventEmitter;\nvar fs = require('fs');\nvar path = require('path');\nvar globule = require('globule');\nvar helper = require('./helper');\n\n// shim setImmediate for node v0.8\nvar setImmediate = require('timers').setImmediate;\nif (typeof setImmediate !== 'function') {\n  setImmediate = process.nextTick;\n}\n\n// globals\nvar delay = 10;\n\n// `Gaze` EventEmitter object to return in the callback\nfunction Gaze(patterns, opts, done) {\n  var self = this;\n  EE.call(self);\n\n  // If second arg is the callback\n  if (typeof opts === 'function') {\n    done = opts;\n    opts = {};\n  }\n\n  // Default options\n  opts = opts || {};\n  opts.mark = true;\n  opts.interval = opts.interval || 100;\n  opts.debounceDelay = opts.debounceDelay || 500;\n  opts.cwd = opts.cwd || process.cwd();\n  this.options = opts;\n\n  // Default done callback\n  done = done || function() {};\n\n  // Remember our watched dir:files\n  this._watched = Object.create(null);\n\n  // Store watchers\n  this._watchers = Object.create(null);\n\n  // Store watchFile listeners\n  this._pollers = Object.create(null);\n\n  // Store patterns\n  this._patterns = [];\n\n  // Cached events for debouncing\n  this._cached = Object.create(null);\n\n  // Set maxListeners\n  if (this.options.maxListeners) {\n    this.setMaxListeners(this.options.maxListeners);\n    Gaze.super_.prototype.setMaxListeners(this.options.maxListeners);\n    delete this.options.maxListeners;\n  }\n\n  // Initialize the watch on files\n  if (patterns) {\n    this.add(patterns, done);\n  }\n\n  // keep the process alive\n  this._keepalive = setInterval(function() {}, 200);\n\n  return this;\n}\nutil.inherits(Gaze, EE);\n\n// Main entry point. Start watching and call done when setup\nmodule.exports = function gaze(patterns, opts, done) {\n  return new Gaze(patterns, opts, done);\n};\nmodule.exports.Gaze = Gaze;\n\n// Override the emit function to emit `all` events\n// and debounce on duplicate events per file\nGaze.prototype.emit = function() {\n  var self = this;\n  var args = arguments;\n\n  var e = args[0];\n  var filepath = args[1];\n  var timeoutId;\n\n  // If not added/deleted/changed/renamed then just emit the event\n  if (e.slice(-2) !== 'ed') {\n    Gaze.super_.prototype.emit.apply(self, args);\n    return this;\n  }\n\n  // Detect rename event, if added and previous deleted is in the cache\n  if (e === 'added') {\n    Object.keys(this._cached).forEach(function(oldFile) {\n      if (self._cached[oldFile].indexOf('deleted') !== -1) {\n        args[0] = e = 'renamed';\n        [].push.call(args, oldFile);\n        delete self._cached[oldFile];\n        return false;\n      }\n    });\n  }\n\n  // If cached doesnt exist, create a delay before running the next\n  // then emit the event\n  var cache = this._cached[filepath] || [];\n  if (cache.indexOf(e) === -1) {\n    helper.objectPush(self._cached, filepath, e);\n    clearTimeout(timeoutId);\n    timeoutId = setTimeout(function() {\n      delete self._cached[filepath];\n    }, this.options.debounceDelay);\n    // Emit the event and `all` event\n    Gaze.super_.prototype.emit.apply(self, args);\n    Gaze.super_.prototype.emit.apply(self, ['all', e].concat([].slice.call(args, 1)));\n  }\n\n  // Detect if new folder added to trigger for matching files within folder\n  if (e === 'added') {\n    if (helper.isDir(filepath)) {\n      fs.readdirSync(filepath).map(function(file) {\n        return path.join(filepath, file);\n      }).filter(function(file) {\n        return globule.isMatch(self._patterns, file, self.options);\n      }).forEach(function(file) {\n        self.emit('added', file);\n      });\n    }\n  }\n\n  return this;\n};\n\n// Close watchers\nGaze.prototype.close = function(_reset) {\n  var self = this;\n  _reset = _reset === false ? false : true;\n  Object.keys(self._watchers).forEach(function(file) {\n    self._watchers[file].close();\n  });\n  self._watchers = Object.create(null);\n  Object.keys(this._watched).forEach(function(dir) {\n    self._unpollDir(dir);\n  });\n  if (_reset) {\n    self._watched = Object.create(null);\n    setTimeout(function() {\n      self.emit('end');\n      self.removeAllListeners();\n      clearInterval(self._keepalive);\n    }, delay + 100);\n  }\n  return self;\n};\n\n// Add file patterns to be watched\nGaze.prototype.add = function(files, done) {\n  if (typeof files === 'string') { files = [files]; }\n  this._patterns = helper.unique.apply(null, [this._patterns, files]);\n  files = globule.find(this._patterns, this.options);\n  this._addToWatched(files);\n  this.close(false);\n  this._initWatched(done);\n};\n\n// Dont increment patterns and dont call done if nothing added\nGaze.prototype._internalAdd = function(file, done) {\n  var files = [];\n  if (helper.isDir(file)) {\n    files = [helper.markDir(file)].concat(globule.find(this._patterns, this.options));\n  } else {\n    if (globule.isMatch(this._patterns, file, this.options)) {\n      files = [file];\n    }\n  }\n  if (files.length > 0) {\n    this._addToWatched(files);\n    this.close(false);\n    this._initWatched(done);\n  }\n};\n\n// Remove file/dir from `watched`\nGaze.prototype.remove = function(file) {\n  var self = this;\n  if (this._watched[file]) {\n    // is dir, remove all files\n    this._unpollDir(file);\n    delete this._watched[file];\n  } else {\n    // is a file, find and remove\n    Object.keys(this._watched).forEach(function(dir) {\n      var index = self._watched[dir].indexOf(file);\n      if (index !== -1) {\n        self._unpollFile(file);\n        self._watched[dir].splice(index, 1);\n        return false;\n      }\n    });\n  }\n  if (this._watchers[file]) {\n    this._watchers[file].close();\n  }\n  return this;\n};\n\n// Return watched files\nGaze.prototype.watched = function() {\n  return this._watched;\n};\n\n// Returns `watched` files with relative paths to process.cwd()\nGaze.prototype.relative = function(dir, unixify) {\n  var self = this;\n  var relative = Object.create(null);\n  var relDir, relFile, unixRelDir;\n  var cwd = this.options.cwd || process.cwd();\n  if (dir === '') { dir = '.'; }\n  dir = helper.markDir(dir);\n  unixify = unixify || false;\n  Object.keys(this._watched).forEach(function(dir) {\n    relDir = path.relative(cwd, dir) + path.sep;\n    if (relDir === path.sep) { relDir = '.'; }\n    unixRelDir = unixify ? helper.unixifyPathSep(relDir) : relDir;\n    relative[unixRelDir] = self._watched[dir].map(function(file) {\n      relFile = path.relative(path.join(cwd, relDir) || '', file || '');\n      if (helper.isDir(file)) {\n        relFile = helper.markDir(relFile);\n      }\n      if (unixify) {\n        relFile = helper.unixifyPathSep(relFile);\n      }\n      return relFile;\n    });\n  });\n  if (dir && unixify) {\n    dir = helper.unixifyPathSep(dir);\n  }\n  return dir ? relative[dir] || [] : relative;\n};\n\n// Adds files and dirs to watched\nGaze.prototype._addToWatched = function(files) {\n  for (var i = 0; i < files.length; i++) {\n    var file = files[i];\n    var filepath = path.resolve(this.options.cwd, file);\n\n    var dirname = (helper.isDir(file)) ? filepath : path.dirname(filepath);\n    dirname = helper.markDir(dirname);\n\n    // If a new dir is added\n    if (helper.isDir(file) && !(filepath in this._watched)) {\n      helper.objectPush(this._watched, filepath, []);\n    }\n\n    if (file.slice(-1) === '/') { filepath += path.sep; }\n    helper.objectPush(this._watched, path.dirname(filepath) + path.sep, filepath);\n\n    // add folders into the mix\n    var readdir = fs.readdirSync(dirname);\n    for (var j = 0; j < readdir.length; j++) {\n      var dirfile = path.join(dirname, readdir[j]);\n      if (fs.lstatSync(dirfile).isDirectory()) {\n        helper.objectPush(this._watched, dirname, dirfile + path.sep);\n      }\n    }\n  }\n  return this;\n};\n\nGaze.prototype._watchDir = function(dir, done) {\n  var self = this;\n  var timeoutId;\n  try {\n    this._watchers[dir] = fs.watch(dir, function(event) {\n      // race condition. Let's give the fs a little time to settle down. so we\n      // don't fire events on non existent files.\n      clearTimeout(timeoutId);\n      timeoutId = setTimeout(function() {\n        // race condition. Ensure that this directory is still being watched\n        // before continuing.\n        if ((dir in self._watchers) && fs.existsSync(dir)) {\n          done(null, dir);\n        }\n      }, delay + 100);\n    });\n  } catch (err) {\n    return this._handleError(err);\n  }\n  return this;\n};\n\nGaze.prototype._unpollFile = function(file) {\n  if (this._pollers[file]) {\n    fs.unwatchFile(file, this._pollers[file] );\n    delete this._pollers[file];\n  }\n  return this;\n};\n\nGaze.prototype._unpollDir = function(dir) {\n  this._unpollFile(dir);\n  for (var i = 0; i < this._watched[dir].length; i++) {\n    this._unpollFile(this._watched[dir][i]);\n  }\n};\n\nGaze.prototype._pollFile = function(file, done) {\n  var opts = { persistent: true, interval: this.options.interval };\n  if (!this._pollers[file]) {\n    this._pollers[file] = function(curr, prev) {\n      done(null, file);\n    };\n    try {\n      fs.watchFile(file, opts, this._pollers[file]);\n    } catch (err) {\n      return this._handleError(err);\n    }\n  }\n  return this;\n};\n\n// Initialize the actual watch on `watched` files\nGaze.prototype._initWatched = function(done) {\n  var self = this;\n  var cwd = this.options.cwd || process.cwd();\n  var curWatched = Object.keys(self._watched);\n\n  // if no matching files\n  if (curWatched.length < 1) {\n    // Defer to emitting to give a chance to attach event handlers.\n    setImmediate(function () {\n      self.emit('ready', self);\n      if (done) { done.call(self, null, self); }\n      self.emit('nomatch');\n    });\n    return;\n  }\n\n  helper.forEachSeries(curWatched, function(dir, next) {\n    dir = dir || '';\n    var files = self._watched[dir];\n    // Triggered when a watched dir has an event\n    self._watchDir(dir, function(event, dirpath) {\n      var relDir = cwd === dir ? '.' : path.relative(cwd, dir);\n      relDir = relDir || '';\n\n      fs.readdir(dirpath, function(err, current) {\n        if (err) { return self.emit('error', err); }\n        if (!current) { return; }\n\n        try {\n          // append path.sep to directories so they match previous.\n          current = current.map(function(curPath) {\n            if (fs.existsSync(path.join(dir, curPath)) && fs.lstatSync(path.join(dir, curPath)).isDirectory()) {\n              return curPath + path.sep;\n            } else {\n              return curPath;\n            }\n          });\n        } catch (err) {\n          // race condition-- sometimes the file no longer exists\n        }\n\n        // Get watched files for this dir\n        var previous = self.relative(relDir);\n\n        // If file was deleted\n        previous.filter(function(file) {\n          return current.indexOf(file) < 0;\n        }).forEach(function(file) {\n          if (!helper.isDir(file)) {\n            var filepath = path.join(dir, file);\n            self.remove(filepath);\n            self.emit('deleted', filepath);\n          }\n        });\n\n        // If file was added\n        current.filter(function(file) {\n          return previous.indexOf(file) < 0;\n        }).forEach(function(file) {\n          // Is it a matching pattern?\n          var relFile = path.join(relDir, file);\n          // Add to watch then emit event\n          self._internalAdd(relFile, function() {\n            self.emit('added', path.join(dir, file));\n          });\n        });\n\n      });\n    });\n\n    // Watch for change/rename events on files\n    files.forEach(function(file) {\n      if (helper.isDir(file)) { return; }\n      self._pollFile(file, function(err, filepath) {\n        // Only emit changed if the file still exists\n        // Prevents changed/deleted duplicate events\n        if (fs.existsSync(filepath)) {\n          self.emit('changed', filepath);\n        }\n      });\n    });\n\n    next();\n  }, function() {\n\n    // Return this instance of Gaze\n    // delay before ready solves a lot of issues\n    setTimeout(function() {\n      self.emit('ready', self);\n      if (done) { done.call(self, null, self); }\n    }, delay + 100);\n\n  });\n};\n\n// If an error, handle it here\nGaze.prototype._handleError = function(err) {\n  if (err.code === 'EMFILE') {\n    return this.emit('error', new Error('EMFILE: Too many opened files.'));\n  }\n  return this.emit('error', err);\n};\n"]}