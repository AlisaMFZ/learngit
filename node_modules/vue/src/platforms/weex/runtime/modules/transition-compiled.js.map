{"version":3,"sources":["transition.js"],"names":[],"mappings":"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","file":"transition-compiled.js","sourcesContent":["import { warn } from 'core/util/debug'\nimport { extend, once, noop } from 'shared/util'\nimport { activeInstance } from 'core/instance/lifecycle'\nimport { resolveTransition } from 'web/runtime/transition-util'\n\nexport default {\n  create: enter,\n  activate: enter,\n  remove: leave\n}\n\nfunction enter (_, vnode) {\n  const el = vnode.elm\n\n  // call leave callback now\n  if (el._leaveCb) {\n    el._leaveCb.cancelled = true\n    el._leaveCb()\n  }\n\n  const data = resolveTransition(vnode.data.transition)\n  if (!data) {\n    return\n  }\n\n  /* istanbul ignore if */\n  if (el._enterCb) {\n    return\n  }\n\n  const {\n    enterClass,\n    enterToClass,\n    enterActiveClass,\n    appearClass,\n    appearToClass,\n    appearActiveClass,\n    beforeEnter,\n    enter,\n    afterEnter,\n    enterCancelled,\n    beforeAppear,\n    appear,\n    afterAppear,\n    appearCancelled\n  } = data\n\n  let context = activeInstance\n  let transitionNode = activeInstance.$vnode\n  while (transitionNode && transitionNode.parent) {\n    transitionNode = transitionNode.parent\n    context = transitionNode.context\n  }\n\n  const isAppear = !context._isMounted || !vnode.isRootInsert\n\n  if (isAppear && !appear && appear !== '') {\n    return\n  }\n\n  const startClass = isAppear ? appearClass : enterClass\n  const toClass = isAppear ? appearToClass : enterToClass\n  const activeClass = isAppear ? appearActiveClass : enterActiveClass\n  const beforeEnterHook = isAppear ? (beforeAppear || beforeEnter) : beforeEnter\n  const enterHook = isAppear ? (typeof appear === 'function' ? appear : enter) : enter\n  const afterEnterHook = isAppear ? (afterAppear || afterEnter) : afterEnter\n  const enterCancelledHook = isAppear ? (appearCancelled || enterCancelled) : enterCancelled\n\n  const userWantsControl =\n    enterHook &&\n    // enterHook may be a bound method which exposes\n    // the length of original fn as _length\n    (enterHook._length || enterHook.length) > 1\n\n  const stylesheet = vnode.context.$options.style || {}\n  const startState = stylesheet[startClass]\n  const transitionProperties = (stylesheet['@TRANSITION'] && stylesheet['@TRANSITION'][activeClass]) || {}\n  const endState = getEnterTargetState(el, stylesheet, startClass, toClass, activeClass, vnode.context)\n  const needAnimation = Object.keys(endState).length > 0\n\n  const cb = el._enterCb = once(() => {\n    if (cb.cancelled) {\n      enterCancelledHook && enterCancelledHook(el)\n    } else {\n      afterEnterHook && afterEnterHook(el)\n    }\n    el._enterCb = null\n  })\n\n  // We need to wait until the native element has been inserted, but currently\n  // there's no API to do that. So we have to wait \"one frame\" - not entirely\n  // sure if this is guaranteed to be enough (e.g. on slow devices?)\n  setTimeout(() => {\n    const parent = el.parentNode\n    const pendingNode = parent && parent._pending && parent._pending[vnode.key]\n    if (pendingNode &&\n        pendingNode.context === vnode.context &&\n        pendingNode.tag === vnode.tag &&\n        pendingNode.elm._leaveCb) {\n      pendingNode.elm._leaveCb()\n    }\n    enterHook && enterHook(el, cb)\n\n    if (needAnimation) {\n      const animation = vnode.context.$requireWeexModule('animation')\n      animation.transition(el.ref, {\n        styles: endState,\n        duration: transitionProperties.duration || 0,\n        delay: transitionProperties.delay || 0,\n        timingFunction: transitionProperties.timingFunction || 'linear'\n      }, userWantsControl ? noop : cb)\n    } else if (!userWantsControl) {\n      cb()\n    }\n  }, 16)\n\n  // start enter transition\n  beforeEnterHook && beforeEnterHook(el)\n\n  if (startState) {\n    for (const key in startState) {\n      el.setStyle(key, startState[key])\n    }\n  }\n\n  if (!needAnimation && !userWantsControl) {\n    cb()\n  }\n}\n\nfunction leave (vnode, rm) {\n  const el = vnode.elm\n\n  // call enter callback now\n  if (el._enterCb) {\n    el._enterCb.cancelled = true\n    el._enterCb()\n  }\n\n  const data = resolveTransition(vnode.data.transition)\n  if (!data) {\n    return rm()\n  }\n\n  if (el._leaveCb) {\n    return\n  }\n\n  const {\n    leaveClass,\n    leaveToClass,\n    leaveActiveClass,\n    beforeLeave,\n    leave,\n    afterLeave,\n    leaveCancelled,\n    delayLeave\n  } = data\n\n  const userWantsControl =\n    leave &&\n    // leave hook may be a bound method which exposes\n    // the length of original fn as _length\n    (leave._length || leave.length) > 1\n\n  const stylesheet = vnode.context.$options.style || {}\n  const startState = stylesheet[leaveClass]\n  const endState = stylesheet[leaveToClass] || stylesheet[leaveActiveClass]\n  const transitionProperties = (stylesheet['@TRANSITION'] && stylesheet['@TRANSITION'][leaveActiveClass]) || {}\n\n  const cb = el._leaveCb = once(() => {\n    if (el.parentNode && el.parentNode._pending) {\n      el.parentNode._pending[vnode.key] = null\n    }\n    if (cb.cancelled) {\n      leaveCancelled && leaveCancelled(el)\n    } else {\n      rm()\n      afterLeave && afterLeave(el)\n    }\n    el._leaveCb = null\n  })\n\n  if (delayLeave) {\n    delayLeave(performLeave)\n  } else {\n    performLeave()\n  }\n\n  function performLeave () {\n    const animation = vnode.context.$requireWeexModule('animation')\n    // the delayed leave may have already been cancelled\n    if (cb.cancelled) {\n      return\n    }\n    // record leaving element\n    if (!vnode.data.show) {\n      (el.parentNode._pending || (el.parentNode._pending = {}))[vnode.key] = vnode\n    }\n    beforeLeave && beforeLeave(el)\n\n    if (startState) {\n      animation.transition(el.ref, {\n        styles: startState\n      }, next)\n    } else {\n      next()\n    }\n\n    function next () {\n      animation.transition(el.ref, {\n        styles: endState,\n        duration: transitionProperties.duration || 0,\n        delay: transitionProperties.delay || 0,\n        timingFunction: transitionProperties.timingFunction || 'linear'\n      }, userWantsControl ? noop : cb)\n    }\n\n    leave && leave(el, cb)\n    if (!endState && !userWantsControl) {\n      cb()\n    }\n  }\n}\n\n// determine the target animation style for an entering transition.\nfunction getEnterTargetState (el, stylesheet, startClass, endClass, activeClass, vm) {\n  const targetState = {}\n  const startState = stylesheet[startClass]\n  const endState = stylesheet[endClass]\n  const activeState = stylesheet[activeClass]\n  // 1. fallback to element's default styling\n  if (startState) {\n    for (const key in startState) {\n      targetState[key] = el.style[key]\n      if (\n        process.env.NODE_ENV !== 'production' &&\n        targetState[key] == null &&\n        (!activeState || activeState[key] == null) &&\n        (!endState || endState[key] == null)\n      ) {\n        warn(\n          `transition property \"${key}\" is declared in enter starting class (.${startClass}), ` +\n          `but not declared anywhere in enter ending class (.${endClass}), ` +\n          `enter active cass (.${activeClass}) or the element's default styling. ` +\n          `Note in Weex, CSS properties need explicit values to be transitionable.`\n        )\n      }\n    }\n  }\n  // 2. if state is mixed in active state, extract them while excluding\n  //    transition properties\n  if (activeState) {\n    for (const key in activeState) {\n      if (key.indexOf('transition') !== 0) {\n        targetState[key] = activeState[key]\n      }\n    }\n  }\n  // 3. explicit endState has highest priority\n  if (endState) {\n    extend(targetState, endState)\n  }\n  return targetState\n}\n"]}