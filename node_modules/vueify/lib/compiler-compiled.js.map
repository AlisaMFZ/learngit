{"version":3,"sources":["compiler.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;AAAA,IAAI,KAAK,QAAQ,IAAR,CAAT;AACA,IAAI,OAAO,QAAQ,MAAR,CAAX;AACA,IAAI,QAAQ,QAAQ,OAAR,CAAZ;AACA,IAAI,OAAO,QAAQ,UAAR,CAAX;AACA,IAAI,UAAU,QAAQ,QAAR,EAAkB,YAAhC;AACA,IAAI,cAAc,QAAQ,uBAAR,CAAlB;AACA,IAAI,YAAY,QAAQ,YAAR,CAAhB;AACA,IAAI,UAAU,QAAQ,oBAAR,CAAd;;AAEA,IAAI,QAAQ,QAAQ,UAAR,CAAZ;AACA,IAAI,YAAY,QAAQ,aAAR,CAAhB;AACA,IAAI,YAAY,QAAQ,aAAR,CAAhB;AACA,IAAI,eAAe,QAAQ,kBAAR,CAAnB;AACA,IAAI,kBAAkB,QAAQ,qBAAR,CAAtB;;AAEA;AACA,IAAI,mBAAmB,UAAU,GAAV,CAAc,oBAAd,CAAvB;AACA,IAAI,gBAAgB,UAAU,GAAV,CAAc,YAAd,CAApB;;AAEA,IAAI,WAAW,IAAf;AACA,IAAI;AACF,UAAQ,YAAR;AACD,CAFD,CAEE,OAAO,CAAP,EAAU;AACV,aAAW,KAAX;AACD;;AAED,IAAI,UAAU,QAAd;AACA,IAAI,qBAAqB,sBAAc,IAAd,CAAzB;;AAEA;AACA,IAAI,WAAW,OAAO,OAAP,GAAiB,IAAI,OAAJ,EAAhC;AACA,SAAS,eAAT,CAAyB,QAAzB;;AAEA;AACA,IAAI,UAAU,SAAS,OAAT,GAAmB,EAAjC;;AAEA;AACA,SAAS,UAAT,GAAsB,YAAY;AAChC,MAAI,KAAK,QAAQ,IAAR,CAAT;AACA,MAAI,OAAO,QAAQ,MAAR,CAAX;AACA,MAAI,aAAa,KAAK,OAAL,CAAa,QAAQ,GAAR,EAAb,EAA4B,eAA5B,CAAjB;AACA,MAAI,GAAG,UAAH,CAAc,UAAd,CAAJ,EAA+B;AAC7B,aAAS,WAAT,CAAqB,QAAQ,UAAR,CAArB;AACD;AACF,CAPD;;AASA;AACA,SAAS,WAAT,GAAuB,UAAU,MAAV,EAAkB;AACvC;AACA,sBAAY,MAAZ,EAAoB,OAApB,CAA4B,UAAU,GAAV,EAAe;AACzC,QAAI,QAAQ,iBAAZ,EAA+B;AAC7B,cAAQ,GAAR,IAAe,OAAO,GAAP,CAAf;AACD,KAFD,MAEO;AACL;AACA,0BAAY,OAAO,GAAP,CAAZ,EAAyB,OAAzB,CAAiC,UAAU,IAAV,EAAgB;AAC/C,kBAAU,IAAV,IAAkB,OAAO,GAAP,EAAY,IAAZ,CAAlB;AACD,OAFD;AAGD;AACF,GATD;AAUD,CAZD;;AAcA,SAAS,OAAT,GAAmB,UAAU,OAAV,EAAmB,QAAnB,EAA6B,EAA7B,EAAiC;AAClD,MAAI,eAAe,QAAQ,GAAR,CAAY,QAAZ,KAAyB,YAA5C;AACA,MAAI,WAAW,QAAQ,GAAR,CAAY,OAAZ,KAAwB,QAAvC;AACA,MAAI,SAAS,CAAC,CAAC,QAAQ,GAAR,CAAY,WAA3B;;AAEA;AACA,MAAI,KAAK,YAAY,MAAM,QAAN,CAArB;AACA;AACA,MAAI,QAAQ,YAAY,cAAZ,CAA2B,OAA3B,EAAoC,EAAE,KAAK,IAAP,EAApC,CAAZ;;AAEA;AACA,MAAI,iBAAiB,MAAM,MAAN,CAAa,IAAb,CAAkB,UAAU,KAAV,EAAiB;AACtD,WAAO,MAAM,MAAb;AACD,GAFoB,CAArB;;AAIA,MAAI,gBAAgB;AAClB,cAAU,IADQ;AAElB,YAAQ,IAFU;AAGlB,YAAQ;AAHU,GAApB;;AAMA,oBAAQ,GAAR,CAAY,CACV,gBAAgB,MAAM,QAAtB,EAAgC,QAAhC,EAA0C,aAA1C,CADU,EAEV,cAAc,MAAM,MAApB,EAA4B,QAA5B,EAAsC,aAAtC,CAFU,EAGV,MAHU,CAGH,MAAM,MAAN,CAAa,GAAb,CAAiB,UAAU,KAAV,EAAiB;AACzC,WAAO,aAAa,KAAb,EAAoB,QAApB,EAA8B,EAA9B,EAAkC,aAAlC,CAAP;AACD,GAFQ,CAHG,CAAZ,EAMC,IAND,CAMM,UANN,EAOC,KAPD,CAOO,EAPP;;AASA,WAAS,UAAT,GAAuB;AACrB;AACA,QAAI,YAAY,mBAAmB,EAAnB,KAA0B,EAA1C;AACA,uBAAmB,EAAnB,IAAyB,aAAzB;AACA,QAAI,gBAAgB,cAAc,MAAd,KAAyB,UAAU,MAAvD;AACA,QAAI,kBAAkB,cAAc,QAAd,KAA2B,UAAU,QAA3D;;AAEA,QAAI,SAAS,EAAb;AACA,QAAI,MAAM,IAAV;AACA;AACA,QAAI,QAAQ,cAAc,MAAd,CAAqB,IAArB,CAA0B,IAA1B,CAAZ;AACA,QAAI,SAAS,CAAC,QAAd,EAAwB;AACtB;AACA,eAAS,IAAT,CAAc,OAAd,EAAuB;AACrB,cAAM,QADe;AAErB,eAAO;AAFc,OAAvB;AAIA,UAAI,CAAC,QAAQ,UAAb,EAAyB;AACvB,gBAAQ,yBAAe,KAAf,CAAR;AACA,kBACE,6CAA6C,aAA7C,GAA6D,YAA7D,GAA4E,KAA5E,GAAoF,KADtF;AAED;AACF;AACD;AACA,QAAI,SAAS,cAAc,MAA3B;AACA,QAAI,MAAJ,EAAY;AACV,UAAI,QAAQ,SAAZ,EAAuB;AACrB,cAAM,kBAAkB,MAAlB,EAA0B,MAA1B,CAAN;AACD;AACD,gBACE,oBAAoB,MAApB,GAA6B,UAA7B;AACA;AACA,gFAHF;AAID;AACD;AACA,cAAU,iEACR,0BADQ,GAER,qBAFF;AAGA;AACA,QAAI,WAAW,cAAc,QAA7B;AACA,QAAI,QAAJ,EAAc;AACZ,UAAI,CAAC,YAAD,IAAiB,CAAC,QAAtB,EAAgC;AAC9B,kBACE,sDACE,uDADF,GAEE,6DAFF,GAGA,OAJF;AAKD;AACD,UAAI,WAAJ;AACA,UAAI,GAAJ,EAAS;AACP,sBAAc,OAAO,KAAP,CAAa,OAAb,EAAsB,MAApC;AACD;AACD,gBACE,+BAA+B,SAAS,MAAxC,GAAiD,IAAjD,GACA,qCADA,GACwC,SAAS,eADjD,GACmE,IAFrE;AAGA,UAAI,GAAJ,EAAS;AACP,2BAAmB,OAAnB,EAA4B,KAA5B,EAAmC,MAAnC,EAA2C,GAA3C,EAAgD,WAAhD;AACD;AACF;AACD;AACA,QAAI,cAAJ,EAAoB;AAClB,gBAAU,kCAAkC,EAAlC,GAAuC,KAAjD;AACD;AACD;AACA,QAAI,CAAC,YAAD,IAAiB,CAAC,MAAlB,IAA4B,CAAC,QAAjC,EAA2C;AACzC,gBACE,oCACA,0BADA,GAC6B,gBAD7B,GACgD,MADhD,GAEA,0CAFA,GAGA,oCAHA,GAIA,yBAJA;AAKA;AACC,eAAS,CAAC,QAAQ,UAAlB,GACG,kDADH,GAEG,EARJ,IASA,6BATA;AAUA;AACA,iCAXA,GAW8B,EAX9B,GAWmC,wBAXnC,GAYA,cAZA;AAaA;AACG,sBACG,wBAAwB,EAAxB,GAA6B,wBADhC,GAEG,kBACE,0BAA0B,EAA1B,GAA+B,wBADjC,GAEE,EAlBR,IAoBA,OApBA,GAqBA,OAtBF;AAuBD;AACD,QAAI,GAAJ,EAAS;AACP,gBAAU,OAAO,QAAQ,QAAR,CAAiB,IAAI,QAAJ,EAAjB,EAAiC,SAAjC,EAAjB;AACD;AACD,OAAG,IAAH,EAAS,MAAT;AACD;;AAED,WAAS,iBAAT,CAA4B,MAA5B,EAAoC,MAApC,EAA4C;AAC1C;AACA,QAAI,iBAAiB,KAAK,QAAL,CAAc,QAAd,IAA0B,GAA1B,GAAgC,KAAK,WAAW,OAAhB,CAArD;AACA,QAAI,MAAM,IAAI,UAAU,kBAAd,EAAV;AACA,QAAI,gBAAJ,CAAqB,cAArB,EAAqC,OAArC;AACA;AACA,QAAI,QAAQ,cAAc,GAA1B;AACA,QAAI,gBAAgB,SAAS,IAAI,UAAU,iBAAd,CAAgC,KAAhC,CAA7B;AACA,QAAI,kBAAkB,CAAC,SAAS,OAAO,KAAP,CAAa,OAAb,EAAsB,MAA/B,GAAwC,CAAzC,IAA8C,CAApE;AACA,WAAO,KAAP,CAAa,OAAb,EAAsB,OAAtB,CAA8B,UAAU,IAAV,EAAgB,KAAhB,EAAuB;AACnD,UAAI,KAAK,QAAQ,CAAjB;AACA,UAAI,eAAe,gBACf,cAAc,mBAAd,CAAkC,EAAE,MAAM,EAAR,EAAY,QAAQ,CAApB,EAAlC,EAA2D,IAD5C,GAEf,EAFJ;AAGA,UAAI,YAAJ,EAAkB;AAChB,YAAI,UAAJ,CAAe;AACb,kBAAQ,cADK;AAEb,qBAAW;AACT,kBAAM,KAAK,eADF;AAET,oBAAQ;AAFC,WAFE;AAMb,oBAAU;AACR,kBAAM,YADE;AAER,oBAAQ;AAFA;AANG,SAAf;AAWD;AACF,KAlBD;AAmBA,QAAI,eAAJ,GAAsB,cAAtB;AACA,WAAO,GAAP;AACD;AACF,CA5JD;;AA8JA,SAAS,kBAAT,CAA6B,OAA7B,EAAsC,KAAtC,EAA6C,MAA7C,EAAqD,GAArD,EAA0D,WAA1D,EAAuE;AACrE,MAAI,aAAa,OAAO,KAAP,CAAa,OAAb,EAAsB,MAAvC;AACA,MAAI,eAAe,QAAQ,KAAR,CAAc,CAAd,EAAiB,MAAM,QAAN,CAAe,KAAhC,EAAuC,KAAvC,CAA6C,OAA7C,EAAsD,MAAzE;AACA,SAAO,cAAc,UAArB,EAAiC,aAAjC,EAAgD;AAC9C,QAAI,UAAJ,CAAe;AACb,cAAQ,IAAI,eADC;AAEb,iBAAW;AACT,cAAM,WADG;AAET,gBAAQ;AAFC,OAFE;AAMb,gBAAU;AACR,cAAM,YADE;AAER,gBAAQ;AAFA;AANG,KAAf;AAWD;AACF;;AAED,SAAS,eAAT,CAA0B,IAA1B,EAAgC,QAAhC,EAA0C,KAA1C,EAAiD;AAC/C,MAAI,CAAC,IAAL,EAAW,OAAO,kBAAQ,OAAR,EAAP;AACX,MAAI,WAAW,WAAW,IAAX,EAAiB,QAAjB,CAAf;AACA,SAAO,iBAAiB,UAAjB,EAA6B,QAA7B,EAAuC,KAAK,IAA5C,EAAkD,QAAlD,EACJ,IADI,CACC,UAAU,GAAV,EAAe;AACnB,UAAM,QAAN,GAAiB,gBAAgB,GAAhB,EAAqB,QAArB,CAAjB;AACD,GAHI,CAAP;AAID;;AAED,SAAS,aAAT,CAAwB,IAAxB,EAA8B,QAA9B,EAAwC,KAAxC,EAA+C;AAC7C,MAAI,CAAC,IAAL,EAAW,OAAO,kBAAQ,OAAR,EAAP;AACX,MAAI,OAAO,KAAK,IAAL,KAAc,WAAW,OAAX,GAAqB,IAAnC,CAAX;AACA,MAAI,SAAS,WAAW,IAAX,EAAiB,QAAjB,CAAb;AACA,SAAO,iBAAiB,QAAjB,EAA2B,MAA3B,EAAmC,IAAnC,EAAyC,QAAzC,EACJ,IADI,CACC,UAAU,GAAV,EAAe;AACnB,QAAI,OAAO,GAAP,KAAe,QAAnB,EAA6B;AAC3B,YAAM,MAAN,GAAe,GAAf;AACD,KAFD,MAEO;AACL,YAAM,MAAN,GAAe,IAAI,IAAnB;AACA,YAAM,GAAN,GAAY,IAAI,GAAhB;AACD;AACF,GARI,CAAP;AASD;;AAED,SAAS,YAAT,CAAuB,IAAvB,EAA6B,QAA7B,EAAuC,EAAvC,EAA2C,KAA3C,EAAkD;AAChD,MAAI,QAAQ,WAAW,IAAX,EAAiB,QAAjB,CAAZ;AACA,SAAO,iBAAiB,OAAjB,EAA0B,KAA1B,EAAiC,KAAK,IAAtC,EAA4C,QAA5C,EACJ,IADI,CACC,UAAU,GAAV,EAAe;AACnB,UAAM,IAAI,IAAJ,EAAN;AACA,WAAO,aAAa,EAAb,EAAiB,GAAjB,EAAsB,KAAK,MAA3B,EAAmC,OAAnC,EAA4C,IAA5C,CAAiD,UAAU,GAAV,EAAe;AACrE,YAAM,MAAN,CAAa,IAAb,CAAkB,GAAlB;AACD,KAFM,CAAP;AAGD,GANI,CAAP;AAOD;;AAED,SAAS,UAAT,CAAqB,IAArB,EAA2B,QAA3B,EAAqC;AACnC,SAAO,KAAK,GAAL,GACH,QAAQ,KAAK,GAAb,EAAkB,QAAlB,CADG,GAEH,KAAK,OAFT;AAGD;;AAED,SAAS,OAAT,CAAkB,GAAlB,EAAuB,QAAvB,EAAiC;AAC/B,MAAI,MAAM,KAAK,OAAL,CAAa,QAAb,CAAV;AACA,MAAI,UAAU,KAAK,OAAL,CAAa,GAAb,EAAkB,GAAlB,CAAd;AACA,WAAS,IAAT,CAAc,YAAd,EAA4B,OAA5B;AACA,MAAI;AACF,WAAO,GAAG,YAAH,CAAgB,OAAhB,EAAyB,OAAzB,CAAP;AACD,GAFD,CAEE,OAAO,CAAP,EAAU;AACV,YAAQ,KAAR,CAAc,MAAM,GAAN,CACZ,0BAA0B,GAA1B,GACA,gBADA,GACmB,QADnB,GAC8B,GAFlB,CAAd;AAID;AACF;;AAED,SAAS,gBAAT,CAA2B,IAA3B,EAAiC,MAAjC,EAAyC,IAAzC,EAA+C,QAA/C,EAAyD;AACvD,MAAI,UAAU,UAAU,IAAV,CAAd;AACA,MAAI,OAAJ,EAAa;AACX,WAAO,sBAAY,UAAU,OAAV,EAAmB,MAAnB,EAA2B;AAC5C,cAAQ,MAAR,EAAgB,UAAU,GAAV,EAAe,GAAf,EAAoB;AAClC,YAAI,GAAJ,EAAS;AACP;AACA,cAAI,IAAI,SAAR,EAAmB;AACjB,oBAAQ,QAAR,CAAiB,YAAY;AAC3B,sBAAQ,KAAR,CAAc,IAAI,SAAlB;AACD,aAFD;AAGD;AACD,iBAAO,OAAO,GAAP,CAAP;AACD;AACD,gBAAQ,GAAR;AACD,OAXD,EAWG,QAXH,EAWa,QAXb;AAYD,KAbM,CAAP;AAcD,GAfD,MAeO;AACL,WAAO,kBAAQ,OAAR,CAAgB,MAAhB,CAAP;AACD;AACF","file":"compiler-compiled.js","sourcesContent":["var fs = require('fs')\nvar path = require('path')\nvar chalk = require('chalk')\nvar hash = require('hash-sum')\nvar Emitter = require('events').EventEmitter\nvar vueCompiler = require('vue-template-compiler')\nvar sourceMap = require('source-map')\nvar convert = require('convert-source-map')\n\nvar genId = require('./gen-id')\nvar normalize = require('./normalize')\nvar compilers = require('./compilers')\nvar rewriteStyle = require('./style-rewriter')\nvar compileTemplate = require('./template-compiler')\n\n// determine dynamic script paths\nvar hotReloadAPIPath = normalize.dep('vue-hot-reload-api')\nvar insertCSSPath = normalize.lib('insert-css')\n\nvar hasBabel = true\ntry {\n  require('babel-core')\n} catch (e) {\n  hasBabel = false\n}\n\nvar splitRE = /\\r?\\n/g\nvar resolvedPartsCache = Object.create(null)\n\n// expose compiler\nvar compiler = module.exports = new Emitter()\ncompiler.setMaxListeners(Infinity)\n\n// options\nvar options = compiler.options = {}\n\n// load user config\ncompiler.loadConfig = function () {\n  var fs = require('fs')\n  var path = require('path')\n  var configPath = path.resolve(process.cwd(), 'vue.config.js')\n  if (fs.existsSync(configPath)) {\n    compiler.applyConfig(require(configPath))\n  }\n}\n\n// apply config\ncompiler.applyConfig = function (config) {\n  // copy user options to default options\n  Object.keys(config).forEach(function (key) {\n    if (key !== 'customCompilers') {\n      options[key] = config[key]\n    } else {\n      // register compilers\n      Object.keys(config[key]).forEach(function (name) {\n        compilers[name] = config[key][name]\n      })\n    }\n  })\n}\n\ncompiler.compile = function (content, filePath, cb) {\n  var isProduction = process.env.NODE_ENV === 'production'\n  var isServer = process.env.VUE_ENV === 'server'\n  var isTest = !!process.env.VUEIFY_TEST\n\n  // generate css scope id\n  var id = 'data-v-' + genId(filePath)\n  // parse the component into parts\n  var parts = vueCompiler.parseComponent(content, { pad: true })\n\n  // check for scoped style nodes\n  var hasScopedStyle = parts.styles.some(function (style) {\n    return style.scoped\n  })\n\n  var resolvedParts = {\n    template: null,\n    script: null,\n    styles: []\n  }\n\n  Promise.all([\n    processTemplate(parts.template, filePath, resolvedParts),\n    processScript(parts.script, filePath, resolvedParts)\n  ].concat(parts.styles.map(function (style) {\n    return processStyle(style, filePath, id, resolvedParts)\n  })))\n  .then(mergeParts)\n  .catch(cb)\n\n  function mergeParts () {\n    // check whether script/template has changed\n    var prevParts = resolvedPartsCache[id] || {}\n    resolvedPartsCache[id] = resolvedParts\n    var scriptChanged = resolvedParts.script !== prevParts.script\n    var templateChanged = resolvedParts.template !== prevParts.template\n\n    var output = ''\n    var map = null\n    // styles\n    var style = resolvedParts.styles.join('\\n')\n    if (style && !isServer) {\n      // emit style\n      compiler.emit('style', {\n        file: filePath,\n        style: style\n      })\n      if (!options.extractCSS) {\n        style = JSON.stringify(style)\n        output +=\n          'var __vueify_style_dispose__ = require(\"' + insertCSSPath + '\").insert(' + style + ')\\n'\n      }\n    }\n    // script\n    var script = resolvedParts.script\n    if (script) {\n      if (options.sourceMap) {\n        map = generateSourceMap(script, output)\n      }\n      output +=\n        ';(function(){\\n' + script + '\\n})()\\n' +\n        // babel 6 compat\n        'if (module.exports.__esModule) module.exports = module.exports.default\\n'\n    }\n    // in case the user exports with Vue.extend\n    output += 'var __vue__options__ = (typeof module.exports === \"function\"' +\n      '? module.exports.options' +\n      ': module.exports)\\n'\n    // template\n    var template = resolvedParts.template\n    if (template) {\n      if (!isProduction && !isServer) {\n        output +=\n          'if (__vue__options__.functional) {console.error(\"' +\n            '[vueify] functional components are not supported and ' +\n            'should be defined in plain js files using render functions.' +\n          '\")}\\n'\n      }\n      var beforeLines\n      if (map) {\n        beforeLines = output.split(splitRE).length\n      }\n      output +=\n        '__vue__options__.render = ' + template.render + '\\n' +\n        '__vue__options__.staticRenderFns = ' + template.staticRenderFns + '\\n'\n      if (map) {\n        addTemplateMapping(content, parts, output, map, beforeLines)\n      }\n    }\n    // scoped CSS id\n    if (hasScopedStyle) {\n      output += '__vue__options__._scopeId = \"' + id + '\"\\n'\n    }\n    // hot reload\n    if (!isProduction && !isTest && !isServer) {\n      output +=\n        'if (module.hot) {(function () {' +\n        '  var hotAPI = require(\"' + hotReloadAPIPath + '\")\\n' +\n        '  hotAPI.install(require(\"vue\"), true)\\n' +\n        '  if (!hotAPI.compatible) return\\n' +\n        '  module.hot.accept()\\n' +\n        // remove style tag on dispose\n        (style && !options.extractCSS\n          ? '  module.hot.dispose(__vueify_style_dispose__)\\n'\n          : '') +\n        '  if (!module.hot.data) {\\n' +\n        // initial insert\n        '    hotAPI.createRecord(\"' + id + '\", __vue__options__)\\n' +\n        '  } else {\\n' +\n        // update\n          (scriptChanged\n            ? '    hotAPI.reload(\"' + id + '\", __vue__options__)\\n'\n            : templateChanged\n              ? '    hotAPI.rerender(\"' + id + '\", __vue__options__)\\n'\n              : ''\n          ) +\n        '  }\\n' +\n        '})()}'\n    }\n    if (map) {\n      output += '\\n' + convert.fromJSON(map.toString()).toComment()\n    }\n    cb(null, output)\n  }\n\n  function generateSourceMap (script, output) {\n    // hot-reload source map busting\n    var hashedFilename = path.basename(filePath) + '?' + hash(filePath + content)\n    var map = new sourceMap.SourceMapGenerator()\n    map.setSourceContent(hashedFilename, content)\n    // check input source map from babel/coffee etc\n    var inMap = resolvedParts.map\n    var inMapConsumer = inMap && new sourceMap.SourceMapConsumer(inMap)\n    var generatedOffset = (output ? output.split(splitRE).length : 0) + 1\n    script.split(splitRE).forEach(function (line, index) {\n      var ln = index + 1\n      var originalLine = inMapConsumer\n        ? inMapConsumer.originalPositionFor({ line: ln, column: 0 }).line\n        : ln\n      if (originalLine) {\n        map.addMapping({\n          source: hashedFilename,\n          generated: {\n            line: ln + generatedOffset,\n            column: 0\n          },\n          original: {\n            line: originalLine,\n            column: 0\n          }\n        })\n      }\n    })\n    map._hashedFilename = hashedFilename\n    return map\n  }\n}\n\nfunction addTemplateMapping (content, parts, output, map, beforeLines) {\n  var afterLines = output.split(splitRE).length\n  var templateLine = content.slice(0, parts.template.start).split(splitRE).length\n  for (; beforeLines < afterLines; beforeLines++) {\n    map.addMapping({\n      source: map._hashedFilename,\n      generated: {\n        line: beforeLines,\n        column: 0\n      },\n      original: {\n        line: templateLine,\n        column: 0\n      }\n    })\n  }\n}\n\nfunction processTemplate (part, filePath, parts) {\n  if (!part) return Promise.resolve()\n  var template = getContent(part, filePath)\n  return compileAsPromise('template', template, part.lang, filePath)\n    .then(function (res) {\n      parts.template = compileTemplate(res, compiler)\n    })\n}\n\nfunction processScript (part, filePath, parts) {\n  if (!part) return Promise.resolve()\n  var lang = part.lang || (hasBabel ? 'babel' : null)\n  var script = getContent(part, filePath)\n  return compileAsPromise('script', script, lang, filePath)\n    .then(function (res) {\n      if (typeof res === 'string') {\n        parts.script = res\n      } else {\n        parts.script = res.code\n        parts.map = res.map\n      }\n    })\n}\n\nfunction processStyle (part, filePath, id, parts) {\n  var style = getContent(part, filePath)\n  return compileAsPromise('style', style, part.lang, filePath)\n    .then(function (res) {\n      res = res.trim()\n      return rewriteStyle(id, res, part.scoped, options).then(function (res) {\n        parts.styles.push(res)\n      })\n    })\n}\n\nfunction getContent (part, filePath) {\n  return part.src\n    ? loadSrc(part.src, filePath)\n    : part.content\n}\n\nfunction loadSrc (src, filePath) {\n  var dir = path.dirname(filePath)\n  var srcPath = path.resolve(dir, src)\n  compiler.emit('dependency', srcPath)\n  try {\n    return fs.readFileSync(srcPath, 'utf-8')\n  } catch (e) {\n    console.error(chalk.red(\n      'Failed to load src: \"' + src +\n      '\" from file: \"' + filePath + '\"'\n    ))\n  }\n}\n\nfunction compileAsPromise (type, source, lang, filePath) {\n  var compile = compilers[lang]\n  if (compile) {\n    return new Promise(function (resolve, reject) {\n      compile(source, function (err, res) {\n        if (err) {\n          // report babel error codeframe\n          if (err.codeFrame) {\n            process.nextTick(function () {\n              console.error(err.codeFrame)\n            })\n          }\n          return reject(err)\n        }\n        resolve(res)\n      }, compiler, filePath)\n    })\n  } else {\n    return Promise.resolve(source)\n  }\n}\n"]}