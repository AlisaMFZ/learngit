'use strict';

var _typeof2 = require('babel-runtime/helpers/typeof');

var _typeof3 = _interopRequireDefault(_typeof2);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var assign = require('object-assign');
var path = require('path');
var ensureRequire = require('../ensure-require.js');

module.exports = function (raw, cb, compiler, filePath) {
  ensureRequire('sass', 'node-sass');
  var sass = require('node-sass');

  var sassOptions = assign({
    data: raw,
    success: function success(res) {
      if ((typeof res === 'undefined' ? 'undefined' : (0, _typeof3.default)(res)) === 'object') {
        cb(null, res.css);
      } else {
        cb(null, res); // compat for node-sass < 2.0.0
      }
    },
    error: function error(err) {
      cb(err);
    }
  }, compiler.options.sass || {
    sourceComments: true
  });

  var dir = path.dirname(filePath);
  var paths = [dir, process.cwd()];
  sassOptions.includePaths = sassOptions.includePaths ? sassOptions.includePaths.concat(paths) : paths;

  sass.render(sassOptions,
  // callback for node-sass > 3.0.0
  function (err, res) {
    if (err) {
      cb(err);
    } else {
      res.stats.includedFiles.forEach(function (file) {
        compiler.emit('dependency', file);
      });
      cb(null, res.css.toString());
    }
  });
};

//# sourceMappingURL=sass-compiled.js.map