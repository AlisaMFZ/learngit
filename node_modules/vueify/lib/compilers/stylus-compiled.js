'use strict';

var _keys = require('babel-runtime/core-js/object/keys');

var _keys2 = _interopRequireDefault(_keys);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var assign = require('object-assign');
var path = require('path');
var ensureRequire = require('../ensure-require.js');

module.exports = function (raw, cb, compiler, filePath) {
  ensureRequire('stylus', 'stylus');
  var stylus = require('stylus');

  var opts = assign({
    filename: path.basename(filePath)
  }, compiler.options.stylus || {});

  var dir = path.dirname(filePath);
  var paths = [dir, process.cwd()];
  opts.paths = opts.paths ? opts.paths.concat(paths) : paths;

  // using the renderer API so that we can
  // check deps after compilation
  var renderer = stylus(raw);
  (0, _keys2.default)(opts).forEach(function (key) {
    renderer.set(key, opts[key]);
  });

  renderer.render(function (err, css) {
    if (err) return cb(err);
    renderer.deps().forEach(function (file) {
      compiler.emit('dependency', file);
    });
    cb(null, css);
  });
};

//# sourceMappingURL=stylus-compiled.js.map