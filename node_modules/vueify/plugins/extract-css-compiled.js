'use strict';

var _typeof2 = require('babel-runtime/helpers/typeof');

var _typeof3 = _interopRequireDefault(_typeof2);

var _keys = require('babel-runtime/core-js/object/keys');

var _keys2 = _interopRequireDefault(_keys);

var _create = require('babel-runtime/core-js/object/create');

var _create2 = _interopRequireDefault(_create);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var fs = require('fs');
var compiler = require('../lib/compiler');

module.exports = function (b, opts) {
  compiler.applyConfig({
    extractCSS: true
  });

  var styles = (0, _create2.default)(null);
  var outPath = opts.out || opts.o || 'bundle.css';

  b.on('bundle', function (bs) {
    bs.on('end', function () {
      var css = (0, _keys2.default)(styles).map(function (file) {
        return styles[file];
      }).join('\n');
      if ((typeof outPath === 'undefined' ? 'undefined' : (0, _typeof3.default)(outPath)) === 'object' && outPath.write) {
        outPath.write(css);
        outPath.end();
      } else if (typeof outPath === 'string') {
        fs.writeFile(outPath, css, function () {});
      }
    });
  });

  b.on('transform', function (tr, file) {
    if (tr.vueify) {
      tr.on('vueify-style', function (e) {
        styles[e.file] = e.style;
      });
    }
  });
};

//# sourceMappingURL=extract-css-compiled.js.map